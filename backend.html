<!DOCTYPE html>
<html>
<head>
  <title>Store Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    .manager-panel {
      max-width: 600px;
      margin: 20px auto;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .form-group {
      margin-bottom: 15px;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="manager-panel">
    <h2>Jersey Manager</h2>
    <form id="jerseyForm">
      <div class="form-group">
        <input type="text" name="name" placeholder="Jersey Name" required>
      </div>
      <div class="form-group">
        <input type="number" name="price" placeholder="Price" step="0.01" required>
      </div>
      <div class="form-group">
        <input type="text" name="sizes" placeholder="Sizes (S,M,L,XL)" required>
      </div>
      <div class="form-group">
        <textarea name="description" placeholder="Description"></textarea>
      </div>
      <div class="form-group">
        <input type="text" name="image" placeholder="Image filename (upload first)">
      </div>
      <button type="button" onclick="saveJersey()">Save Product</button>
    </form>
    <p id="status"></p>
    
    <h3>Upload Images</h3>
    <input type="file" id="imageUpload" accept="image/*">
    <button onclick="uploadImage()">Upload to GitHub</button>
  </div>

  <script>
    const USERNAME = 'salmontic';
    const REPO = 'store';
    const TOKEN = 'ghp_your_token_here'; // From GitHub Settings > Tokens

    async function saveJersey() {
      const form = document.getElementById('jerseyForm');
      const jersey = {
        name: form.name.value,
        price: parseFloat(form.price.value),
        sizes: form.sizes.value.split(',').map(s => s.trim()),
        description: form.description.value,
        image: form.image.value || 'default.jpg'
      };

      // Get existing jerseys
      let jerseys = [];
      try {
        const response = await fetch('jerseys.json');
        jerseys = await response.json();
      } catch(e) {/* File doesn't exist yet */}
      
      // Add new jersey
      jerseys.push(jersey);
      
      // Update GitHub
      try {
        const sha = await getFileSHA('jerseys.json');
        await updateGitHubFile('jerseys.json', JSON.stringify(jerseys), sha);
        document.getElementById('status').textContent = '✅ Jersey saved!';
        form.reset();
      } catch(error) {
        document.getElementById('status').textContent = '❌ Error: ' + error.message;
      }
    }

    async function uploadImage() {
      const fileInput = document.getElementById('imageUpload');
      if (!fileInput.files.length) return;
      
      const file = fileInput.files[0];
      const filename = `images/${Date.now()}_${file.name}`;
      
      // Convert to Base64
      const reader = new FileReader();
      reader.readAsDataURL(file);
      
      reader.onload = async () => {
        const content = reader.result.split(',')[1]; // Remove data URL prefix
        try {
          await updateGitHubFile(filename, content);
          document.getElementById('status').textContent = `✅ Image uploaded! Use: ${filename}`;
        } catch(error) {
          document.getElementById('status').textContent = '❌ Upload failed: ' + error.message;
        }
      };
    }

    async function getFileSHA(path) {
      const response = await fetch(
        `https://api.github.com/repos/${USERNAME}/${REPO}/contents/${path}`,
        { headers: { 'Authorization': `token ${TOKEN}` } }
      );
      const data = await response.json();
      return data.sha;
    }

    async function updateGitHubFile(path, content, sha = '') {
      const response = await fetch(
        `https://api.github.com/repos/${USERNAME}/${REPO}/contents/${path}`,
        {
          method: 'PUT',
          headers: {
            'Authorization': `token ${TOKEN}`,
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: 'Update store content',
            content: btoa(content),
            sha: sha || undefined
          })
        }
      );
      return response.json();
    }
  </script>
</body>
</html>